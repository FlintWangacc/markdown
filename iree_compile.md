# IREE COMPILE
## executable
target platform executable seems generated by `MaterializeInterfacesPass` after stream dialect.

## stream dialect
stream dialect seems to consider execution stream. Some stream run on virtual machine. Some stream run on device.

## current debug
```bash
third_party/llvm-project/mlir/lib/Pass/Pass.cpp:549
third_party/llvm-project/mlir/lib/IR/MLIRContext.cpp:598
```
## Pass
### ConvertToFlow
ConvertToFlow contains several rewrite pattern
| Pattern | function|
|----------|---------|
|ConvertLinalgFillPattern| Converts linalg.fill ops into flow.tensor.splat ops.|
|ConvertTensorBitcastPattern||
|ConvertTensorExtBitcastPattern||
|ConvertTensorCastPattern||
|ConvertTensorConcatPattern||
|ConvertTensorExtractPattern||
|ConvertTensorExtractSlicePattern||
|ConvertTensorInsertSlicePattern|Convert tensor.insert_slice ops into flow.tensor.update ops where possible.|
|ConvertTensorFromElementsPattern||
|ConvertTensorDialectReshapeOpPattern|Convert tensor.reshape ops into flow.tensor.reshape ops where possible.|
|ConvertTensorReshapePattern<tensor::CollapseShapeOp>|Converts linalg.tensor_reshape operations into flow.tensor.reshape operations|
|ConvertTensorReshapePattern<tensor::ExpandShapeOp>||
#### TensorPadToTensorInsertSlicePass
```bash
Full path: /home/hmsjwzb/work/pytorch/iree/compiler/src/iree/compiler/DispatchCreation/TensorPadToTensorInsertSlice.cpp
Line: 96
```
##### CanonicalizePass
file: compiler/src/iree/compiler/Dialect/Flow/Transforms/Canonicalize.cpp
line: 110

## How iree create executable kernel

### FormDispatchRegionsPass
location:
```bash
compiler/src/iree/compiler/DispatchCreation/FormDispatchRegions.cpp
FormDispatchRegionsPass::runOnOperation

Full path: /home/hmsjwzb/work/pytorch/iree/compiler/src/iree/compiler/DispatchCreation/FormDispatchRegions.cpp
Line: 1011
```

## How iree change the mlir kernel to llvm ir kernel
### passname
TranslateTargetExecutableVariantsPass

### location
```bash
Full path: /home/hmsjwzb/work/pytorch/iree/compiler/src/iree/compiler/Dialect/HAL/Transforms/TranslateExecutables.cpp
Line: 76
```
### subpass
1. HoistExecutableObjectsPass
	- compiler/src/iree/compiler/Dialect/HAL/Transforms/HoistExecutableObjects.cpp


## Tricks
### How to disable multi-thread in mlir
  Set the flag specifying if multi-threading is disabled by the context.
   The command line debugging flag `--mlir-disable-threading` is overriding
   this call and making it a no-op!
<!--stackedit_data:
eyJoaXN0b3J5IjpbNzQ5Mzk2ODA0LDExMTIwOTU3NTcsLTY3MD
c4MDg0MF19
-->